"use client";

import { faArrowLeft } from "@fortawesome/free-solid-svg-icons";
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import Link from "next/link";
import React, { useEffect, useRef, useState } from "react";

import ThemeToggle from "@/components/theme_toggle";
import Button from "@/components/ui/button";
import cn from "@/utils/core/cn";

import { FE_COLORS } from "../theme";

const FutureEvalNavbar: React.FC = () => {
  const sentinelRef = useRef<HTMLDivElement | null>(null);
  const [scrolled, setScrolled] = useState(false);

  useEffect(() => {
    const el = sentinelRef.current;
    if (!el) return;

    const obs = new IntersectionObserver(
      ([entry]) => setScrolled(!entry?.isIntersecting),
      {
        root: null,
        threshold: 0,
        rootMargin: "0px 0px 0px 0px",
      }
    );

    obs.observe(el);
    return () => obs.disconnect();
  }, []);

  return (
    <>
      {/* Sentinel element to detect scroll */}
      <div ref={sentinelRef} className="absolute left-0 top-0 h-px w-full" />

      <header
        className={cn(
          "fixed left-0 top-0 z-[200] flex h-header w-full items-center justify-between px-3 transition-all duration-200 sm:px-6 md:px-8",
          scrolled
            ? cn(FE_COLORS.navbarScrolled, "backdrop-blur-md")
            : FE_COLORS.navbarTransparent
        )}
      >
        {/* Metaculus Logo - links to FutureEval home */}
        <Link
          href="/futureeval"
          className="flex items-center no-underline transition-opacity hover:opacity-80"
        >
          {/* Metaculus logo SVG */}
          <svg
            width="91"
            height="20"
            viewBox="0 0 91 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-auto w-[70px] sm:w-[91px]"
          >
            <path
              d="M2.12522 18.9913V6.15826L4.25043 18.9913H5.34029L7.46551 6.15826V18.9913H9.64522V0.81797H6.59362L4.79536 9.86377L2.9971 0.81797H0V18.9913H2.12522ZM17.3741 19.182C19.4993 19.182 20.6709 17.8742 20.6709 15.5038L20.6705 15.3089C20.6694 15.1243 20.6644 14.9562 20.6437 14.2504H18.3005V15.3948C18.3005 16.5119 18.028 17.0023 17.4014 17.0023C16.8019 17.0023 16.5567 16.5936 16.5567 15.6128V12.6157H20.6437V8.63768C20.6437 6.53971 19.4448 5.25913 17.4558 5.25913C15.2761 5.25913 14.1863 6.51246 14.1863 9.04638V15.3675C14.1863 16.6209 14.377 17.3565 14.9219 18.0377C15.5214 18.8006 16.3387 19.182 17.3741 19.182ZM18.2732 10.7357H16.5567V8.44696C16.5567 7.82029 16.8837 7.43884 17.4286 7.43884C17.9735 7.43884 18.2732 7.79304 18.2732 8.44696V10.7357ZM28.5633 19.182C28.9447 19.182 29.2444 19.1275 29.9256 18.9913V16.8116L29.4897 16.8388C28.645 16.8388 28.2636 16.4574 28.2636 15.5855V7.62956H29.9256V5.44985H28.2636V1.74435H25.8931V5.44985H24.7488V7.62956H25.8931V16.4029C25.8931 18.2284 26.8195 19.182 28.5633 19.182ZM35.9107 19.182C36.7009 19.182 37.3548 18.7733 37.9269 17.9015C37.9542 18.3101 38.0087 18.7188 38.0904 18.9913H40.5426C40.3367 18.348 40.301 17.9963 40.2977 16.9952L40.2974 8.50145C40.2974 6.40348 39.2075 5.25913 37.2185 5.25913C35.9925 5.25913 35.0661 5.74957 34.5484 6.70319C34.1942 7.32985 34.058 7.95652 33.9217 9.42783H36.2104C36.3194 7.79304 36.4829 7.43884 37.1913 7.43884C37.818 7.43884 37.9269 7.62956 37.9269 8.66493V10.1907C37.6817 10.3542 37.5183 10.4632 37.4638 10.4904C35.5565 11.7438 35.5565 11.7438 34.9843 12.3704C34.1942 13.2696 33.84 14.3049 33.84 15.749C33.84 18.0104 34.5484 19.182 35.9107 19.182ZM36.9461 16.9751C36.4556 16.9751 36.2104 16.4846 36.2104 15.5583C36.2104 14.0052 36.6464 13.1061 37.9269 12.0435V16.2667C37.6 16.7571 37.3003 16.9751 36.9461 16.9751ZM47.999 19.182C50.1515 19.182 51.3231 17.8742 51.3231 15.4765L51.3228 15.3239C51.3214 15.1001 51.3136 14.9103 51.2686 14.0325H48.9254V15.3948C48.9254 16.5936 48.7074 17.0023 48.0263 17.0023C47.4269 17.0023 47.1816 16.5936 47.1816 15.6128V8.82841C47.1816 7.84754 47.4269 7.43884 48.0263 7.43884C48.7074 7.43884 48.9254 7.84754 48.9254 9.04638V10.1907H51.2686C51.3122 9.47142 51.3209 9.27525 51.3227 9.08605L51.3231 8.93739C51.3231 6.56696 50.1242 5.25913 47.999 5.25913C46.9637 5.25913 46.1463 5.64058 45.5469 6.40348C45.0019 7.05739 44.8112 7.79304 44.8112 9.07362V15.3675C44.8112 16.6481 45.0019 17.3838 45.5469 18.0377C46.1463 18.8006 46.9637 19.182 47.999 19.182ZM57.4172 19.182C58.0983 19.182 58.6433 18.8551 59.6241 17.8197L59.8149 18.9913H61.9946V5.44985H59.6241V16.4574C59.1337 16.8661 58.8885 17.0023 58.5615 17.0023C58.1528 17.0023 57.9621 16.6754 57.9621 15.9942V5.44985H55.5917V16.0759C55.5917 17.4383 55.6734 17.9559 55.9731 18.4191C56.2456 18.8551 56.845 19.182 57.4172 19.182ZM68.9061 18.9913V0.81797H66.5356V18.9913H68.9061ZM75.2454 19.182C75.9266 19.182 76.4715 18.8551 77.4524 17.8197L77.6431 18.9913H79.8228V5.44985H77.4524V16.4574C76.9619 16.8661 76.7167 17.0023 76.3897 17.0023C75.9811 17.0023 75.7903 16.6754 75.7903 15.9942V5.44985H73.4199V16.0759C73.4199 17.4383 73.5016 17.9559 73.8013 18.4191C74.0738 18.8551 74.6732 19.182 75.2454 19.182ZM87.0612 19.182C89.023 19.182 90.3308 17.7925 90.3308 15.6945C90.3308 14.3322 89.8131 13.3241 88.3691 11.7983L87.4155 10.8174C86.6798 10.0272 86.4346 9.53681 86.4346 8.71942C86.4346 7.82029 86.6798 7.43884 87.2247 7.43884C87.7424 7.43884 88.0149 7.84754 88.0149 8.66493V8.85565L90.2763 8.69217C90.2763 7.82029 90.2218 7.41159 90.0311 6.89391C89.6224 5.85855 88.6688 5.25913 87.3882 5.25913C85.2085 5.25913 84.1186 6.40348 84.1186 8.66493C84.1186 10.0817 84.6363 11.3078 85.6717 12.3977L86.5981 13.3513C87.7152 14.5229 87.9604 14.9861 87.9604 15.8307C87.9604 16.5391 87.6062 17.0023 87.0612 17.0023C86.4891 17.0023 86.1621 16.5664 86.1621 15.8307C86.1621 15.6945 86.1621 15.6128 86.1894 15.3948L83.9007 15.5583C83.8734 15.6945 83.8734 15.749 83.8734 15.8852C83.8734 17.9015 85.0995 19.182 87.0612 19.182Z"
              fill="white"
            />
          </svg>
        </Link>

        {/* Right side: Platform button + Dark mode toggle */}
        <div className="flex items-center gap-3 sm:gap-4">
          <Button
            variant="text"
            size="sm"
            href="/"
            className="gap-2 text-gray-200 hover:text-white dark:text-gray-300 dark:hover:text-white"
          >
            <FontAwesomeIcon icon={faArrowLeft} className="text-xs" />
            <span className="hidden sm:inline">Metaculus Platform</span>
            <span className="inline sm:hidden">Platform</span>
          </Button>

          <ThemeToggle />
        </div>
      </header>
    </>
  );
};

export default FutureEvalNavbar;
